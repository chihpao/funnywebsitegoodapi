stages:
  - test
  - deploy

variables:
  NODE_ENV: production
  PNPM_CACHE_FOLDER: .pnpm-store  # æŒ‡å®š pnpm çš„å¿«å–ç›®éŒ„

cache:
  paths:
    - .pnpm-store  # å¿«å– pnpm å®‰è£çš„å¥—ä»¶ï¼ŒåŠ é€Ÿå¾ŒçºŒ CI/CD é€Ÿåº¦

test-job:
  stage: test
  image: node:18  # ä½ å¯ä»¥æ”¹æˆå…¶ä»– Node.js ç‰ˆæœ¬
  before_script:
    - corepack enable  # ç¢ºä¿ pnpm å¯ç”¨
    - pnpm install --frozen-lockfile  # å®‰è£ä¾è³´ï¼Œä½†ä¸ä¿®æ”¹ lockfile
  script:
    - echo "ğŸ” Running tests..."
    - pnpm run test  # é€™è£¡è«‹æ”¹æˆä½ çš„æ¸¬è©¦æŒ‡ä»¤
  only:
    - main

deploy-job:
  stage: deploy
  image: node:18
  before_script:
    - corepack enable
    - pnpm install --frozen-lockfile
  script:
    - echo "ğŸš€ Deploying to production server..."
    - pnpm run build  # åŸ·è¡Œå»ºç½®
    - scp -r ./dist/ user@your-server-ip:/var/www/html  # é€™è¡Œè¦–ä½ çš„éƒ¨ç½²æ–¹å¼èª¿æ•´
  only:
    - main
